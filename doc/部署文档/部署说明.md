# KTG-MES éƒ¨ç½²è¯´æ˜

## ğŸš€ ä¸€é”®éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚

- Docker 20.10+
- Docker Compose 1.29+
- è‡³å°‘ 4GB å¯ç”¨å†…å­˜
- è‡³å°‘ 10GB å¯ç”¨ç£ç›˜ç©ºé—´

### å¿«é€Ÿå¼€å§‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://gitee.com/kutangguo/ktg-mes.git
cd ktg-mes

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 4. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker-compose logs -f
```

### ç­‰å¾…æœåŠ¡å¯åŠ¨

é¦–æ¬¡å¯åŠ¨éœ€è¦ç­‰å¾…ä»¥ä¸‹æœåŠ¡å®Œå…¨å¯åŠ¨ï¼š

1. **MySQLæ•°æ®åº“** (çº¦30ç§’) - è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨
2. **Redisç¼“å­˜** (çº¦10ç§’) - å¯åŠ¨ç¼“å­˜æœåŠ¡
3. **MinIOå­˜å‚¨** (çº¦15ç§’) - å¯åŠ¨å¯¹è±¡å­˜å‚¨
4. **å‰ç«¯æ„å»º** (çº¦2-3åˆ†é’Ÿ) - ç¼–è¯‘å‰ç«¯ä»£ç 
5. **åç«¯åº”ç”¨** (çº¦1-2åˆ†é’Ÿ) - å¯åŠ¨Spring Bootåº”ç”¨
6. **Nginxä»£ç†** (çº¦5ç§’) - å¯åŠ¨WebæœåŠ¡å™¨

**æ€»å¯åŠ¨æ—¶é—´**: çº¦5-8åˆ†é’Ÿ

## ğŸ“ è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ | ç”¨æˆ·å | å¯†ç  | è¯´æ˜ |
|------|------|--------|------|------|
| **å‰ç«¯è®¿é—®** | http://localhost:8000 | admin | admin123 | ä¸»ç³»ç»Ÿç•Œé¢ |
| **åç«¯API** | http://localhost:8007 | - | - | APIæ¥å£ |
| **æ•°æ®åº“ç®¡ç†** | localhost:8001 | ktgmes | ktgmes123 | MySQLæ•°æ®åº“ |
| **Redisç®¡ç†** | localhost:8002 | - | - | Redisç¼“å­˜ |
| **MinIOç®¡ç†** | http://localhost:8004 | minioadmin | minioadmin123 | å¯¹è±¡å­˜å‚¨ |
| **RabbitMQç®¡ç†** | http://localhost:8006 | admin | admin123 | æ¶ˆæ¯é˜Ÿåˆ— |
| **Druidç›‘æ§** | http://localhost:8000/druid/ | admin | 123456 | æ•°æ®åº“è¿æ¥æ± ç›‘æ§ |

## ğŸ”§ æœåŠ¡ç®¡ç†

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f ktg-mes-app
docker-compose logs -f ktg-mes-ui-builder
docker-compose logs -f mysql
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart ktg-mes-app
docker-compose restart ktg-mes-ui-builder
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡ï¼ˆä¿ç•™æ•°æ®ï¼‰
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æ•°æ®
docker-compose down -v
```

## ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†

### æ•°æ®åº“åˆå§‹åŒ–

æ•°æ®åº“ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–ï¼ŒåŒ…å«ï¼š

- **176ä¸ªæ•°æ®è¡¨** - å®Œæ•´çš„MESä¸šåŠ¡è¡¨ç»“æ„
- **ç³»ç»Ÿæ•°æ®** - ç”¨æˆ·ã€è§’è‰²ã€èœå•ã€æƒé™ç­‰
- **ä¸šåŠ¡æ•°æ®** - ä¸»æ•°æ®ã€ç”Ÿäº§ã€è´¨é‡ã€ä»“å‚¨ç­‰æ¨¡å—
- **é»˜è®¤è´¦æˆ·** - admin/admin123

### æ‰‹åŠ¨é‡æ–°åˆå§‹åŒ–

```bash
# ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
bash sql/reinit_database.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
docker exec -i ktg-mes-mysql mysql -uktgmes -pktgmes123 ktgmes < sql/ry_20210908.sql
```

### æ•°æ®åº“å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
docker exec ktg-mes-mysql mysqldump -uktgmes -pktgmes123 ktgmes > backup_$(date +%Y%m%d_%H%M%S).sql

# æ¢å¤æ•°æ®åº“
docker exec -i ktg-mes-mysql mysql -uktgmes -pktgmes123 ktgmes < backup_20250930_120000.sql
```

## ğŸ” æ•…éšœæ’é™¤

### 1. ç«¯å£å†²çª

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ï¼š

```yaml
ports:
  - "8000:80"  # æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼Œå¦‚ "8080:80"
```

### 2. å†…å­˜ä¸è¶³

å¦‚æœå†…å­˜ä¸è¶³ï¼Œå¯ä»¥ï¼š

```bash
# å‡å°‘æœåŠ¡æ•°é‡ï¼ˆç§»é™¤RabbitMQï¼‰
docker-compose up -d mysql redis minio nginx ktg-mes-ui-builder ktg-mes-app

# æˆ–è°ƒæ•´JVMå‚æ•°
# ç¼–è¾‘ docker-compose.yml ä¸­çš„ command éƒ¨åˆ†
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MySQLçŠ¶æ€
docker-compose logs mysql

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»º
docker exec -it ktg-mes-mysql mysql -uktgmes -pktgmes123 -e "SHOW DATABASES;"
```

### 4. å‰ç«¯æ„å»ºå¤±è´¥

```bash
# æŸ¥çœ‹æ„å»ºæ—¥å¿—
docker-compose logs ktg-mes-ui-builder

# æ‰‹åŠ¨é‡æ–°æ„å»º
docker-compose restart ktg-mes-ui-builder
```

### 5. åº”ç”¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs ktg-mes-app

# æ£€æŸ¥é…ç½®æ–‡ä»¶
docker exec -it ktg-mes-app cat /app/config/application-prod.yml
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **å¢åŠ å†…å­˜**: å»ºè®®è‡³å°‘8GBå†…å­˜
2. **SSDå­˜å‚¨**: ä½¿ç”¨SSDæé«˜æ•°æ®åº“æ€§èƒ½
3. **ç½‘ç»œä¼˜åŒ–**: ä½¿ç”¨åƒå…†ç½‘ç»œ
4. **å®šæœŸå¤‡ä»½**: è®¾ç½®è‡ªåŠ¨å¤‡ä»½ç­–ç•¥

### ç›‘æ§é…ç½®

1. **å¯ç”¨Druidç›‘æ§**: è®¿é—® http://localhost:8000/druid/
2. **æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—**: `docker-compose logs -f`
3. **ç›‘æ§èµ„æºä½¿ç”¨**: `docker stats`

## ğŸ”’ å®‰å…¨é…ç½®

### ä¿®æ”¹é»˜è®¤å¯†ç 

1. **æ•°æ®åº“å¯†ç **: ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ `MYSQL_PASSWORD`
2. **åº”ç”¨å¯†ç **: ä¿®æ”¹ `config/application-prod.yml` ä¸­çš„æ•°æ®åº“é…ç½®
3. **MinIOå¯†ç **: ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ `MINIO_ROOT_PASSWORD`
4. **ç³»ç»Ÿè´¦æˆ·**: ç™»å½•ç³»ç»Ÿåä¿®æ”¹adminå¯†ç 

### ç½‘ç»œå®‰å…¨

1. **é˜²ç«å¢™é…ç½®**: åªå¼€æ”¾å¿…è¦ç«¯å£
2. **HTTPSé…ç½®**: é…ç½®SSLè¯ä¹¦
3. **è®¿é—®æ§åˆ¶**: è®¾ç½®IPç™½åå•

## ğŸ“ ç»´æŠ¤å»ºè®®

### æ—¥å¸¸ç»´æŠ¤

1. **å®šæœŸå¤‡ä»½**: æ¯æ—¥å¤‡ä»½æ•°æ®åº“
2. **æ—¥å¿—æ¸…ç†**: å®šæœŸæ¸…ç†åº”ç”¨æ—¥å¿—
3. **ç›‘æ§æ£€æŸ¥**: å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€
4. **æ›´æ–°å‡çº§**: å®šæœŸæ›´æ–°Dockeré•œåƒ

### æ•…éšœé¢„é˜²

1. **èµ„æºç›‘æ§**: ç›‘æ§CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
2. **æ—¥å¿—åˆ†æ**: å®šæœŸåˆ†æé”™è¯¯æ—¥å¿—
3. **æ€§èƒ½æµ‹è¯•**: å®šæœŸè¿›è¡Œå‹åŠ›æµ‹è¯•
4. **å¤‡ä»½éªŒè¯**: å®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§

---

**æœ€åæ›´æ–°**: 2025-09-30  
**ç»´æŠ¤è€…**: KTG-MESå¼€å‘å›¢é˜Ÿ
