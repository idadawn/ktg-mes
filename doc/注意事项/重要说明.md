# KTG-MES 重要注意事项

## ⚠️ 部署前必读

### 1. 环境要求

- **Docker版本**: 20.10+ (必须)
- **Docker Compose版本**: 1.29+ (必须)
- **系统内存**: 至少4GB，推荐8GB+
- **磁盘空间**: 至少10GB可用空间
- **操作系统**: Linux/macOS/Windows (推荐Linux)

### 2. 端口占用检查

部署前请确保以下端口未被占用：

| 端口 | 服务 | 说明 |
|------|------|------|
| 8000 | Nginx | 前端访问端口 |
| 8001 | MySQL | 数据库端口 |
| 8002 | Redis | 缓存端口 |
| 8003 | MinIO API | 对象存储API |
| 8004 | MinIO Console | 对象存储管理界面 |
| 8005 | RabbitMQ | 消息队列端口 |
| 8006 | RabbitMQ Management | 消息队列管理界面 |
| 8007 | Spring Boot | 后端应用端口 |

**检查命令**:
```bash
# Linux/macOS
netstat -tulpn | grep -E ':(8000|8001|8002|8003|8004|8005|8006|8007)'

# Windows
netstat -an | findstr ":800"
```

### 3. 防火墙配置

确保防火墙允许以下端口访问：

```bash
# Ubuntu/Debian
sudo ufw allow 8000:8007/tcp

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8000-8007/tcp
sudo firewall-cmd --reload
```

## 🔒 安全注意事项

### 1. 默认密码修改

**部署后必须立即修改以下默认密码**:

| 服务 | 默认用户名 | 默认密码 | 修改位置 |
|------|------------|----------|----------|
| 系统登录 | admin | admin123 | 登录后修改 |
| MySQL | ktgmes | ktgmes123 | docker-compose.yml |
| MinIO | minioadmin | minioadmin123 | docker-compose.yml |
| RabbitMQ | admin | admin123 | docker-compose.yml |
| Druid监控 | admin | 123456 | config/application-prod.yml |

### 2. 生产环境配置

**生产环境部署时务必**:

1. **修改所有默认密码**
2. **启用HTTPS** (配置SSL证书)
3. **设置IP白名单** (限制访问来源)
4. **定期备份数据**
5. **监控系统资源使用情况**

### 3. 网络安全

- 不要将管理端口暴露到公网
- 使用VPN或内网访问管理界面
- 定期更新Docker镜像和系统补丁

## 📊 性能注意事项

### 1. 内存配置

**推荐配置**:

| 环境 | 最小内存 | 推荐内存 | JVM堆内存 |
|------|----------|----------|-----------|
| 开发环境 | 4GB | 8GB | 1GB |
| 测试环境 | 8GB | 16GB | 2GB |
| 生产环境 | 16GB | 32GB+ | 4GB+ |

### 2. 数据库优化

- 使用SSD存储提高数据库性能
- 定期清理日志文件
- 监控数据库连接数
- 定期备份和优化数据库

### 3. 存储空间

**预估存储需求**:

| 数据类型 | 预估大小 | 说明 |
|----------|----------|------|
| 数据库 | 1-5GB | 根据业务数据量 |
| 日志文件 | 500MB-2GB | 建议定期清理 |
| 上传文件 | 根据使用情况 | 图片、文档等 |
| 备份文件 | 数据库大小×2 | 建议保留多个备份 |

## 🐛 常见问题预防

### 1. 启动失败

**常见原因**:
- 端口被占用
- 内存不足
- 磁盘空间不足
- Docker版本不兼容

**预防措施**:
- 部署前检查环境要求
- 确保有足够的系统资源
- 使用推荐的Docker版本

### 2. 数据库连接失败

**常见原因**:
- MySQL容器启动失败
- 网络连接问题
- 字符编码问题

**预防措施**:
- 等待MySQL完全启动后再启动应用
- 检查网络配置
- 确保使用utf8mb4字符集

### 3. 前端访问异常

**常见原因**:
- 前端构建失败
- Nginx配置错误
- 静态文件路径错误

**预防措施**:
- 检查前端构建日志
- 验证Nginx配置
- 确保静态文件正确部署

## 📝 维护建议

### 1. 定期维护

**每日**:
- 检查服务状态
- 查看错误日志
- 监控资源使用

**每周**:
- 清理日志文件
- 检查磁盘空间
- 验证备份完整性

**每月**:
- 更新Docker镜像
- 优化数据库
- 安全审计

### 2. 备份策略

**自动备份**:
```bash
# 设置定时任务，每日凌晨2点备份
0 2 * * * cd /home/dawn/project/mes/ktg-mes && bash sql/reinit_database.sh
```

**手动备份**:
```bash
# 数据库备份
docker exec ktg-mes-mysql mysqldump -uktgmes -pktgmes123 ktgmes > backup_$(date +%Y%m%d_%H%M%S).sql

# 文件备份
tar -czf upload_backup_$(date +%Y%m%d_%H%M%S).tar.gz upload/
```

### 3. 监控告警

建议配置以下监控指标：
- CPU使用率
- 内存使用率
- 磁盘使用率
- 数据库连接数
- 应用响应时间
- 错误日志数量

## 🚨 紧急情况处理

### 1. 服务完全无法访问

**处理步骤**:
1. 检查Docker服务状态: `docker ps`
2. 查看容器日志: `docker-compose logs`
3. 重启所有服务: `docker-compose restart`
4. 检查系统资源: `free -h`, `df -h`

### 2. 数据库损坏

**处理步骤**:
1. 停止应用服务: `docker-compose stop ktg-mes-app`
2. 从备份恢复数据库
3. 重启应用服务: `docker-compose start ktg-mes-app`

### 3. 数据丢失

**处理步骤**:
1. 立即停止所有服务
2. 检查备份文件完整性
3. 从最近的有效备份恢复
4. 验证数据完整性

## 📞 技术支持

### 获取帮助

1. **查看日志**: `docker-compose logs -f [service-name]`
2. **检查状态**: `docker-compose ps`
3. **查看文档**: `/doc` 目录
4. **联系支持**: QQ群 411641505

### 问题报告

报告问题时请提供：
- 操作系统版本
- Docker版本
- 错误日志
- 复现步骤
- 系统配置信息

---

**重要提醒**: 在生产环境部署前，请务必在测试环境充分验证所有功能！

**最后更新**: 2025-09-30  
**维护者**: KTG-MES开发团队
